{% extends 'base2.html' %}

{% load static %}
{% block content %}
<style>
  .small-btn {
    padding: 0.3rem 0.1rem; 
    height: 10px; /* Chiều cao nút */
    width: 40px; /* Chiều rộng nút */
}
  .wishlist-link:hover img {
    color: red;
  }
</style>

<div class="container">
  
  <section class="breadcrumb-section" style="margin-top:-35px">
    <h2 class="sr-only">Site Breadcrumb</h2>
    <div class="container">
      <div class="breadcrumb-contents">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item" style="margin-left:-13px"><a href="{% url 'home' %}">Home</a></li>
            <li class="breadcrumb-item active">Product Details</li>
          </ol>
        </nav>
      </div>
    </div>
    {% if messages %}
    <div class="alert alert-warning" alert-{{ message.tags }}" role="alert" style="margin-top: -30px; height: 70px; margin-bottom: 10px;">
    {% for message in messages  %}
      {{message|safe}} - <a href="{% url 'wishlist'  %}" class="alert-link">Your Wishlist</a>.
    {% endfor %}
    {% endif %}
  </section>
  
  <div class="card mb-3" style="max-width: 820px; margin-top:-20px">
    <div class="row no-gutters">
      <div class="col-md-4">
        <img src="{{ product.image_url }}" class="card-img">
      </div>
      <div class="col-md-8">
        <div class="card-body">
          <h4 class="card-title" style="margin-top:-20px">{{ product.title }}</h4>
          <p class="card-text" style="margin-top:-5px">Author: {{ product.author }}</p><hr>
          {% load rating_stars %}
          <p class="card-text" style="margin-top:-10px">Rating: {{ product.rating|floatformat:2 }} <span class="star-rating">{% render_stars product.rating %} 
            <a href="{% url 'user_wishlist' product.id  %}" class="wishlist-link" style="margin-left: 320px; ">
              <img src="{% static 'website/images/bookmark.png' %}"  alt="Cart" style="width: 40px; height: 40px;">
            </a>
          </span></p>
          
          <p class="card-text" style="margin-top:-25px">Publisher: {{ product.publisher }}</p>
          <p class="card-text" style="margin-top:-20px">Price: $ {{ product.price|floatformat:2 }}</p>
          <p class="card-text" style="margin-top:-20px">{{ product.description }}</p>
        </div>
        <div class="card-footer">
          <div class="row">
            <div class="col-md-6">
              <form id="add-to-basket-form" method="post" action="{% url 'basket:basket_add' %}" style="display: inline-block">
                {% csrf_token %}
                <input type="hidden" name="productid" value="{{ product.id }}">
                <div class="quantity d-flex align-items-center">
                  <button type="button" id="minus-btn" class="btn btn-sm btn-outline-secondary small-btn" ><a style="font-size: 25px">-</a></button>
                  <input type="text" id="quantity-input" class="form-control mx-2 small-btn" style="width: 60px; height: 40px; font-size: 16px" name="productqty" value="1">
                  <button type="button" id="plus-btn" class="btn btn-sm btn-outline-secondary small-btn">
                  <a style="font-size: 25px">+</a></button>
                </div>
                <button type="submit" id="add-to-basket-btn" class="btn btn-secondary btn-sm" role="button" style="width:200px; display: flex; align-items: center; justify-content: center; margin-top: 10px">
                  Add to basket
                  <img src="{% static 'website/images/shopping-cart.png' %}" alt="Cart" style="width: 20px; height: 20px; margin-left: 10px;">
                </button>
              </form>
            </div>
            <div class="col-md-6">
              <div style="padding-top:24px; width: 180px; padding-left: 30px">
                {% if product.book_available %}
                <a href="{% url 'basket:basket_checkout2' %}"  class="btn btn-outline-success" role="button" style="width:200px; display: flex; align-items: center; justify-content: center; margin-top: 36px">
                  Buy Now 
                  <img src="{% static 'website/images/checklist.png' %}" alt="Cart" style="width: 20px; height: 20px; margin-left: 10px;">
                </a>
                {% else %}
                <h4 class="text-danger">Out of Stock!</h4>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Phần hiển thị comment -->
    <div>
      <h3>Comments</h3>
      {% for comment in product.comments.all %}
          <div class="comment">
              <p><strong>{{ comment.user.username }}</strong> said on {{ comment.created_at|date:"Y-m-d H:i" }}:</p>
              <p>{{ comment.content }}</p>
          </div>
      {% empty %}
          <p>No comments yet.</p>
      {% endfor %}
      <hr>
      <!-- Form thêm comment -->
      <h4>Add a comment:</h4>
      <form method="post" >
        {% csrf_token %}
        <input type="hidden" name="book_id" value="{{ product.id }}" />
        <label for="id_content">Comment:</label>
        <textarea class="mb-0 form-control" id="id_content" name="content" placeholder="Enter your comment here..." required></textarea>
        <button type="submit" class="btn btn-primary">Submit</button>
      </form>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const minusButton = document.getElementById('minus-btn');
  const plusButton = document.getElementById('plus-btn');
  const quantityInput = document.getElementById('quantity-input');

  minusButton.addEventListener('click', function () {
    let qty = parseInt(quantityInput.value);
    if (qty > 1) {
      quantityInput.value = qty - 1;
    }
  });

  plusButton.addEventListener('click', function () {
    let qty = parseInt(quantityInput.value);
    quantityInput.value = qty + 1;
  });
});
</script>

{% endblock content %}
